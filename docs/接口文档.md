# Vnollx Online Judge 接口文档

## 1. 接口规范

### 1.1 基础信息

- **Base URL**: `http://your-domain.com/api`
- **协议**: HTTP/HTTPS
- **数据格式**: JSON
- **字符编码**: UTF-8

### 1.2 请求头

| Header | 说明 | 必填 |
|--------|------|------|
| Content-Type | application/json | 是 |
| Authorization | Bearer {token} | 需认证接口 |

### 1.3 响应格式

```json
{
  "code": 200,      // 状态码：200成功，其他失败
  "msg": "success", // 消息描述
  "data": {}        // 返回数据
}
```

### 1.4 状态码

| 状态码 | 说明 |
|--------|------|
| 200 | 成功 |
| 400 | 请求参数错误 |
| 401 | 未认证/Token过期 |
| 403 | 权限不足 |
| 404 | 资源不存在 |
| 500 | 服务器内部错误 |

---

## 2. 用户接口

### 2.1 用户注册

**POST** `/user/register`

**请求体**
```json
{
  "name": "username",
  "email": "user@example.com",
  "password": "password123",
  "code": "123456"  // 邮箱验证码
}
```

**响应**
```json
{
  "code": 200,
  "msg": "注册成功",
  "data": null
}
```

### 2.2 用户登录

**POST** `/user/login`

**请求体**
```json
{
  "email": "user@example.com",
  "password": "password123"
}
```

**响应**
```json
{
  "code": 200,
  "msg": "登录成功",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiJ9...",
    "id": 1,
    "name": "username",
    "identity": "USER"
  }
}
```

### 2.3 获取个人资料

**GET** `/user/profile`

**Header**: Authorization: Bearer {token}

**响应**
```json
{
  "code": 200,
  "msg": "success",
  "data": {
    "id": 1,
    "name": "username",
    "email": "user@example.com",
    "identity": "USER",
    "avatar": "http://...",
    "submitCount": 100,
    "passCount": 50,
    "createTime": "2024-01-01T00:00:00"
  }
}
```

### 2.4 更新个人资料

**PUT** `/user/profile`

**Header**: Authorization: Bearer {token}

**请求体**
```json
{
  "name": "newname",
  "avatar": "http://..."
}
```

### 2.5 修改密码

**PUT** `/user/password`

**Header**: Authorization: Bearer {token}

**请求体**
```json
{
  "oldPassword": "oldpass",
  "newPassword": "newpass"
}
```

### 2.6 用户排行榜

**GET** `/user/ranklist`

**参数**
| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| pageNum | int | 否 | 页码，默认1 |
| pageSize | int | 否 | 每页数量，默认20 |

**响应**
```json
{
  "code": 200,
  "data": [
    {
      "rank": 1,
      "id": 1,
      "name": "user1",
      "passCount": 100,
      "submitCount": 150
    }
  ]
}
```

---

## 3. 题目接口

### 3.1 题目列表

**GET** `/problem/list`

**参数**
| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| pageNum | int | 是 | 页码 |
| pageSize | int | 是 | 每页数量 |
| keyword | string | 否 | 搜索关键词 |
| difficulty | int | 否 | 难度 1-5 |
| tagId | long | 否 | 标签ID |

**响应**
```json
{
  "code": 200,
  "data": [
    {
      "id": 1,
      "title": "两数之和",
      "difficulty": 1,
      "submitCount": 1000,
      "acceptCount": 500,
      "acceptRate": "50.00%",
      "tags": [
        { "id": 1, "name": "数组" }
      ]
    }
  ]
}
```

### 3.2 题目详情

**GET** `/problem/{id}`

**响应**
```json
{
  "code": 200,
  "data": {
    "id": 1,
    "title": "两数之和",
    "description": "给定一个整数数组...",
    "inputFormat": "第一行输入n...",
    "outputFormat": "输出两个数的下标...",
    "sampleInput": "4\n2 7 11 15\n9",
    "sampleOutput": "0 1",
    "hint": "可以使用哈希表...",
    "difficulty": 1,
    "timeLimit": 1000,
    "memoryLimit": 256,
    "tags": [
      { "id": 1, "name": "数组" },
      { "id": 2, "name": "哈希表" }
    ]
  }
}
```

### 3.3 题目数量

**GET** `/problem/count`

**参数**
| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| keyword | string | 否 | 搜索关键词 |
| difficulty | int | 否 | 难度 |

**响应**
```json
{
  "code": 200,
  "data": 150
}
```

---

## 4. 评测接口

### 4.1 提交代码

**POST** `/judge/submit`

**Header**: Authorization: Bearer {token}

**请求体**
```json
{
  "problemId": 1,
  "code": "#include <iostream>\nint main() { ... }",
  "language": "cpp"
}
```

**响应**
```json
{
  "code": 200,
  "msg": "提交成功",
  "data": {
    "submissionId": 12345
  }
}
```

### 4.2 提交记录列表

**GET** `/submission/list`

**参数**
| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| pageNum | int | 是 | 页码 |
| pageSize | int | 是 | 每页数量 |
| problemId | long | 否 | 题目ID |
| userId | long | 否 | 用户ID |
| status | string | 否 | 状态 |
| language | string | 否 | 语言 |

**响应**
```json
{
  "code": 200,
  "data": [
    {
      "id": 12345,
      "problemId": 1,
      "problemTitle": "两数之和",
      "userId": 1,
      "userName": "user1",
      "language": "cpp",
      "status": "Accepted",
      "timeUsed": 15,
      "memoryUsed": 1024,
      "submitTime": "2024-01-01T12:00:00"
    }
  ]
}
```

### 4.3 提交详情

**GET** `/submission/{id}`

**响应**
```json
{
  "code": 200,
  "data": {
    "id": 12345,
    "problemId": 1,
    "userId": 1,
    "code": "#include <iostream>...",
    "language": "cpp",
    "status": "Accepted",
    "timeUsed": 15,
    "memoryUsed": 1024,
    "errorInfo": null,
    "judgeInfo": [
      { "testcase": 1, "status": "Accepted", "time": 10, "memory": 512 },
      { "testcase": 2, "status": "Accepted", "time": 15, "memory": 1024 }
    ],
    "submitTime": "2024-01-01T12:00:00"
  }
}
```

---

## 5. 比赛接口

### 5.1 比赛列表

**GET** `/competition/list`

**参数**
| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| pageNum | int | 是 | 页码 |
| pageSize | int | 是 | 每页数量 |
| status | int | 否 | 状态：0未开始/1进行中/2已结束 |

**响应**
```json
{
  "code": 200,
  "data": [
    {
      "id": 1,
      "title": "周赛第1期",
      "startTime": "2024-01-01T14:00:00",
      "endTime": "2024-01-01T17:00:00",
      "status": 2,
      "hasPassword": false,
      "participantCount": 100
    }
  ]
}
```

### 5.2 比赛详情

**GET** `/competition/{id}`

**响应**
```json
{
  "code": 200,
  "data": {
    "id": 1,
    "title": "周赛第1期",
    "description": "比赛说明...",
    "startTime": "2024-01-01T14:00:00",
    "endTime": "2024-01-01T17:00:00",
    "status": 2,
    "hasPassword": false,
    "problems": [
      { "order": "A", "id": 1, "title": "题目A" },
      { "order": "B", "id": 2, "title": "题目B" }
    ]
  }
}
```

### 5.3 比赛排名

**GET** `/competition/{id}/ranklist`

**响应**
```json
{
  "code": 200,
  "data": [
    {
      "rank": 1,
      "userId": 1,
      "userName": "user1",
      "solved": 5,
      "penalty": 150,
      "problems": [
        { "order": "A", "accepted": true, "time": 30, "attempts": 1 },
        { "order": "B", "accepted": true, "time": 60, "attempts": 2 }
      ]
    }
  ]
}
```

### 5.4 加入比赛

**POST** `/competition/{id}/join`

**Header**: Authorization: Bearer {token}

**请求体**（仅需密码的比赛）
```json
{
  "password": "contest123"
}
```

---

## 6. 练习接口

### 6.1 练习列表

**GET** `/practice/list`

**参数**
| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| pageNum | int | 是 | 页码 |
| pageSize | int | 是 | 每页数量 |

### 6.2 练习详情

**GET** `/practice/{id}`

**响应**
```json
{
  "code": 200,
  "data": {
    "id": 1,
    "title": "动态规划入门",
    "description": "练习说明...",
    "problems": [
      { "order": 1, "id": 1, "title": "斐波那契" },
      { "order": 2, "id": 2, "title": "爬楼梯" }
    ]
  }
}
```

---

## 7. 题解接口

### 7.1 题解列表

**GET** `/solve/list`

**参数**
| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| pageNum | int | 是 | 页码 |
| pageSize | int | 是 | 每页数量 |
| problemId | long | 否 | 题目ID |

### 7.2 题解详情

**GET** `/solve/{id}`

**响应**
```json
{
  "code": 200,
  "data": {
    "id": 1,
    "title": "两数之和 - 哈希表解法",
    "content": "## 思路\n使用哈希表...",
    "userId": 1,
    "userName": "user1",
    "problemId": 1,
    "problemTitle": "两数之和",
    "likeCount": 50,
    "viewCount": 1000,
    "createTime": "2024-01-01T00:00:00"
  }
}
```

### 7.3 发布题解

**POST** `/solve/create`

**Header**: Authorization: Bearer {token}

**请求体**
```json
{
  "problemId": 1,
  "title": "题解标题",
  "content": "题解内容（Markdown）"
}
```

---

## 8. 好友接口

### 8.1 搜索用户

**GET** `/friend/search`

**参数**
| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| keyword | string | 是 | 用户名/邮箱 |

### 8.2 发送好友请求

**POST** `/friend/request`

**请求体**
```json
{
  "targetUserId": 2
}
```

### 8.3 好友列表

**GET** `/friend/list`

**响应**
```json
{
  "code": 200,
  "data": [
    {
      "id": 2,
      "name": "friend1",
      "avatar": "http://...",
      "online": true
    }
  ]
}
```

### 8.4 发送私信

**POST** `/friend/message`

**请求体**
```json
{
  "receiverId": 2,
  "content": "你好！"
}
```

### 8.5 消息记录

**GET** `/friend/messages`

**参数**
| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| friendId | long | 是 | 好友ID |
| pageNum | int | 否 | 页码 |
| pageSize | int | 否 | 每页数量 |

---

## 9. 通知接口

### 9.1 通知列表

**GET** `/notification/list`

**Header**: Authorization: Bearer {token}

**参数**
| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| pageNum | int | 是 | 页码 |
| pageSize | int | 是 | 每页数量 |
| status | string | 否 | read/unread |

### 9.2 未读数量

**GET** `/notification/count`

**响应**
```json
{
  "code": 200,
  "data": 5
}
```

### 9.3 标记已读

**PUT** `/notification/read/{id}`

---

## 10. AI接口

### 10.1 AI对话

**POST** `/ai/chat`

**Header**: Authorization: Bearer {token}

**请求体**
```json
{
  "message": "请解释这段代码的时间复杂度",
  "context": "可选的上下文信息"
}
```

**响应**
```json
{
  "code": 200,
  "data": {
    "reply": "这段代码的时间复杂度是O(n)..."
  }
}
```

---

## 11. 标签接口

### 11.1 标签列表

**GET** `/tag/list`

**响应**
```json
{
  "code": 200,
  "data": [
    { "id": 1, "name": "数组", "count": 50 },
    { "id": 2, "name": "字符串", "count": 30 },
    { "id": 3, "name": "动态规划", "count": 40 }
  ]
}
```

---

## 12. 邮件接口

### 12.1 发送验证码

**POST** `/email/send`

**请求体**
```json
{
  "email": "user@example.com",
  "type": "register"  // register/reset
}
```

---

## 13. 管理员接口

### 13.1 用户管理

| 方法 | 接口 | 说明 |
|------|------|------|
| GET | `/admin/user/list` | 用户列表 |
| GET | `/admin/user/count` | 用户数量 |
| POST | `/admin/user/add` | 添加用户 |
| PUT | `/admin/user/update` | 更新用户 |
| DELETE | `/admin/user/delete/{id}` | 删除用户 |

### 13.2 题目管理

| 方法 | 接口 | 说明 |
|------|------|------|
| GET | `/admin/problem/list` | 题目列表 |
| POST | `/admin/problem/create` | 创建题目 |
| PUT | `/admin/problem/update` | 更新题目 |
| DELETE | `/admin/problem/delete/{id}` | 删除题目 |
| POST | `/admin/problem/testcase` | 上传测试用例 |

### 13.3 比赛管理

| 方法 | 接口 | 说明 |
|------|------|------|
| GET | `/admin/competition/list` | 比赛列表 |
| POST | `/admin/competition/create` | 创建比赛 |
| PUT | `/admin/competition/update` | 更新比赛 |
| DELETE | `/admin/competition/delete/{id}` | 删除比赛 |
| POST | `/admin/competition/problem` | 添加题目 |

### 13.4 权限管理

| 方法 | 接口 | 说明 |
|------|------|------|
| GET | `/admin/permission/roles` | 角色列表 |
| GET | `/admin/permission/permissions` | 权限列表 |
| GET | `/admin/permission/user/{id}/roles` | 用户角色 |
| POST | `/admin/permission/user/{id}/role/{roleId}` | 分配角色 |
| DELETE | `/admin/permission/user/{id}/role/{roleId}` | 移除角色 |
| POST | `/admin/permission/user/{id}/refresh` | 刷新缓存 |
| POST | `/admin/permission/cache/clear` | 清除所有缓存 |

### 13.5 系统设置

| 方法 | 接口 | 说明 |
|------|------|------|
| GET | `/admin/ai/config` | 获取AI配置 |
| PUT | `/admin/ai/config` | 更新AI配置 |

---

## 14. WebSocket接口

### 14.1 评测结果推送

**连接地址**: `ws://your-domain.com/ws/judge`

**消息格式**
```json
{
  "type": "judge_result",
  "data": {
    "submissionId": 12345,
    "status": "Accepted",
    "timeUsed": 15,
    "memoryUsed": 1024
  }
}
```

### 14.2 私信推送

**连接地址**: `ws://your-domain.com/ws/message`

**消息格式**
```json
{
  "type": "private_message",
  "data": {
    "senderId": 1,
    "senderName": "user1",
    "content": "你好！",
    "time": "2024-01-01T12:00:00"
  }
}
```
