# Vnollx Online Judge 前端开发文档

## 1. 技术栈

| 技术 | 版本 | 说明 |
|------|------|------|
| React | 19.2.0 | UI框架 |
| TypeScript | 5.9.3 | 类型安全的JavaScript |
| Vite | 7.2.4 | 构建工具 |
| Ant Design | 5.21.0 | UI组件库 |
| TailwindCSS | 3.4.17 | 原子化CSS框架 |
| Monaco Editor | 0.55.1 | VS Code同款代码编辑器 |
| React Router | 6.26.0 | 路由管理 |
| Axios | 1.7.7 | HTTP客户端 |
| Lucide React | 0.555.0 | 图标库 |
| React Hot Toast | 2.6.0 | 通知提示 |
| Three.js | 0.181.2 | 3D效果 |

## 2. 项目结构

```
frontend/
├── public/                    # 静态资源
├── src/
│   ├── App.tsx               # 根组件，路由配置
│   ├── main.tsx              # 入口文件
│   ├── index.css             # 全局样式
│   ├── assets/               # 资源文件
│   ├── components/           # 公共组件
│   │   ├── AIAssistant/      # AI助手组件
│   │   ├── Auth/             # 认证组件（登录/注册弹窗）
│   │   ├── CodeEditor/       # 代码编辑器
│   │   ├── CodeWindow/       # 代码展示窗口
│   │   ├── CountUp/          # 数字动画
│   │   ├── Layout/           # 布局组件
│   │   ├── ParticleBackground/ # 粒子背景
│   │   └── index.ts          # 组件导出
│   ├── hooks/                # 自定义Hook
│   ├── pages/                # 页面组件
│   │   ├── About/            # 关于页面
│   │   ├── Admin/            # 管理后台
│   │   ├── CompetitionDetail/  # 比赛详情
│   │   ├── CompetitionProblemDetail/ # 比赛题目详情
│   │   ├── CompetitionRanklist/ # 比赛排名
│   │   ├── CompetitionSubmissions/ # 比赛提交
│   │   ├── Competitions/     # 比赛列表
│   │   ├── ForgotPassword/   # 忘记密码
│   │   ├── Friends/          # 好友页面
│   │   ├── Home/             # 首页
│   │   ├── Login/            # 登录页
│   │   ├── NotificationDetail/ # 通知详情
│   │   ├── Notifications/    # 通知列表
│   │   ├── PracticeDetail/   # 练习详情
│   │   ├── Practices/        # 练习列表
│   │   ├── ProblemDetail/    # 题目详情
│   │   ├── Problems/         # 题目列表
│   │   ├── Ranklist/         # 排行榜
│   │   ├── Register/         # 注册页
│   │   ├── Settings/         # 设置页
│   │   ├── Solutions/        # 题解
│   │   ├── Submissions/      # 提交记录
│   │   ├── UserProfile/      # 用户资料
│   │   └── index.ts          # 页面导出
│   ├── types/                # 类型定义
│   │   └── index.ts          # 全局类型
│   └── utils/                # 工具函数
│       ├── api.ts            # API封装
│       └── auth.ts           # 认证工具
├── index.html                # HTML模板
├── package.json              # 依赖配置
├── tsconfig.json             # TypeScript配置
├── vite.config.ts            # Vite配置
├── tailwind.config.js        # TailwindCSS配置
└── postcss.config.js         # PostCSS配置
```

## 3. 路由配置

```typescript
// App.tsx 路由配置
<Routes>
  {/* 公共页面 */}
  <Route path="/" element={<Home />} />
  <Route path="/problems" element={<Problems />} />
  <Route path="/problem/:id" element={<ProblemDetail />} />
  <Route path="/competitions" element={<Competitions />} />
  <Route path="/competition/:id" element={<CompetitionDetail />} />
  <Route path="/practices" element={<Practices />} />
  <Route path="/practice/:id" element={<PracticeDetail />} />
  <Route path="/submissions" element={<Submissions />} />
  <Route path="/ranklist" element={<Ranklist />} />
  <Route path="/solutions" element={<Solutions />} />
  <Route path="/friends" element={<Friends />} />
  <Route path="/notifications" element={<Notifications />} />
  <Route path="/settings" element={<Settings />} />
  <Route path="/user/:id" element={<UserProfile />} />
  
  {/* 管理后台 */}
  <Route path="/admin/*" element={<Admin />} />
  
  {/* 认证页面 */}
  <Route path="/login" element={<Login />} />
  <Route path="/register" element={<Register />} />
  <Route path="/forgot-password" element={<ForgotPassword />} />
</Routes>
```

## 4. 核心组件

### 4.1 布局组件 (Layout)

```typescript
// components/Layout/AppLayout.tsx
const AppLayout: React.FC<{ children: React.ReactNode }> = ({ children }) => {
  return (
    <div className="app-layout">
      <ParticleBackground />
      <Header />
      <main className="main-content">
        {children}
      </main>
      <Footer />
      <AuthModal />
      <AIAssistant />
    </div>
  );
};
```

### 4.2 代码编辑器 (CodeEditor)

```typescript
// components/CodeEditor/index.tsx
import Editor from '@monaco-editor/react';

interface CodeEditorProps {
  language: string;
  value: string;
  onChange: (value: string) => void;
  height?: string;
}

const CodeEditor: React.FC<CodeEditorProps> = ({
  language,
  value,
  onChange,
  height = '400px'
}) => {
  return (
    <Editor
      height={height}
      language={language}
      value={value}
      onChange={(val) => onChange(val || '')}
      theme="vs-dark"
      options={{
        minimap: { enabled: false },
        fontSize: 14,
        lineNumbers: 'on',
        automaticLayout: true,
      }}
    />
  );
};
```

### 4.3 认证组件 (Auth)

```typescript
// components/Auth/AuthModal.tsx
const AuthModal: React.FC = () => {
  const [mode, setMode] = useState<'login' | 'register'>('login');
  const [visible, setVisible] = useState(false);

  return (
    <Modal open={visible} onCancel={() => setVisible(false)}>
      {mode === 'login' ? (
        <LoginForm onSwitch={() => setMode('register')} />
      ) : (
        <RegisterForm onSwitch={() => setMode('login')} />
      )}
    </Modal>
  );
};
```

### 4.4 AI助手 (AIAssistant)

```typescript
// components/AIAssistant/index.tsx
const AIAssistant: React.FC = () => {
  const [messages, setMessages] = useState<Message[]>([]);
  const [input, setInput] = useState('');
  const [visible, setVisible] = useState(false);

  const sendMessage = async () => {
    const response = await api.post('/ai/chat', { message: input });
    setMessages([...messages, 
      { role: 'user', content: input },
      { role: 'assistant', content: response.data }
    ]);
  };

  return (
    <FloatButton onClick={() => setVisible(true)} />
    // ... 聊天界面
  );
};
```

## 5. API封装

### 5.1 Axios配置

```typescript
// utils/api.ts
import axios from 'axios';

const api = axios.create({
  baseURL: '/api',
  timeout: 30000,
});

// 请求拦截器 - 添加Token
api.interceptors.request.use((config) => {
  const token = localStorage.getItem('token');
  if (token) {
    config.headers.Authorization = `Bearer ${token}`;
  }
  return config;
});

// 响应拦截器 - 处理错误
api.interceptors.response.use(
  (response) => response.data,
  (error) => {
    if (error.response?.status === 401) {
      localStorage.removeItem('token');
      window.location.href = '/';
    }
    return Promise.reject(error);
  }
);

export default api;
```

### 5.2 API调用示例

```typescript
// 获取题目列表
const getProblems = async (params: ProblemQuery) => {
  const data = await api.get('/problem/list', { params });
  return data.data;
};

// 提交代码
const submitCode = async (dto: SubmitDTO) => {
  const data = await api.post('/judge/submit', dto);
  return data;
};

// 获取用户信息
const getUserProfile = async () => {
  const data = await api.get('/user/profile');
  return data.data;
};
```

## 6. 认证工具

```typescript
// utils/auth.ts
export const isAuthenticated = (): boolean => {
  const token = localStorage.getItem('token');
  return !!token;
};

export const getUserInfo = () => {
  return {
    id: localStorage.getItem('id'),
    name: localStorage.getItem('name'),
    identity: localStorage.getItem('identity'),
  };
};

export const logout = () => {
  localStorage.removeItem('token');
  localStorage.removeItem('id');
  localStorage.removeItem('name');
  localStorage.removeItem('identity');
};

export const setUserInfo = (data: UserInfo) => {
  localStorage.setItem('token', data.token);
  localStorage.setItem('id', data.id);
  localStorage.setItem('name', data.name);
  localStorage.setItem('identity', data.identity);
};
```

## 7. 类型定义

```typescript
// types/index.ts

// API响应类型
export interface ApiResponse<T = any> {
  code: number;
  msg: string;
  data: T;
}

// 用户类型
export interface User {
  id: number;
  name: string;
  email: string;
  identity: 'USER' | 'ADMIN' | 'SUPER_ADMIN';
  submitCount: number;
  passCount: number;
  avatar?: string;
}

// 题目类型
export interface Problem {
  id: number;
  title: string;
  description: string;
  difficulty: number;
  timeLimit: number;
  memoryLimit: number;
  submitCount: number;
  acceptCount: number;
  tags: Tag[];
}

// 提交类型
export interface Submission {
  id: number;
  problemId: number;
  userId: number;
  code: string;
  language: string;
  status: string;
  timeUsed: number;
  memoryUsed: number;
  submitTime: string;
}

// 比赛类型
export interface Competition {
  id: number;
  title: string;
  description: string;
  startTime: string;
  endTime: string;
  status: number;
  hasPassword: boolean;
}
```

## 8. 页面开发

### 8.1 管理后台结构

```typescript
// pages/Admin/index.tsx
const Admin: React.FC = () => {
  const menuItems = [
    { key: '/admin/users', icon: <Users />, label: '用户管理' },
    { key: '/admin/problems', icon: <HelpCircle />, label: '题目管理' },
    { key: '/admin/solves', icon: <Lightbulb />, label: '题解管理' },
    { key: '/admin/competitions', icon: <Trophy />, label: '比赛管理' },
    { key: '/admin/practices', icon: <BookOpen />, label: '练习管理' },
    { key: '/admin/permissions', icon: <Key />, label: '权限管理' },
    { key: '/admin/settings', icon: <Settings />, label: '系统设置' },
  ];

  return (
    <Layout>
      <Sider>
        <Menu items={menuItems} />
      </Sider>
      <Content>
        <Routes>
          <Route path="users" element={<AdminUsers />} />
          <Route path="problems" element={<AdminProblems />} />
          <Route path="permissions" element={<AdminPermissions />} />
          {/* ... */}
        </Routes>
      </Content>
    </Layout>
  );
};
```

### 8.2 题目详情页

```typescript
// pages/ProblemDetail/index.tsx
const ProblemDetail: React.FC = () => {
  const { id } = useParams();
  const [problem, setProblem] = useState<Problem | null>(null);
  const [code, setCode] = useState('');
  const [language, setLanguage] = useState('cpp');

  useEffect(() => {
    loadProblem();
  }, [id]);

  const handleSubmit = async () => {
    await api.post('/judge/submit', {
      problemId: id,
      code,
      language,
    });
    toast.success('提交成功');
  };

  return (
    <div className="problem-detail">
      <div className="problem-content">
        <h1>{problem?.title}</h1>
        <Markdown>{problem?.description}</Markdown>
      </div>
      <div className="code-editor">
        <Select value={language} onChange={setLanguage}>
          <Option value="cpp">C++</Option>
          <Option value="java">Java</Option>
          <Option value="python">Python</Option>
        </Select>
        <CodeEditor
          language={language}
          value={code}
          onChange={setCode}
        />
        <Button onClick={handleSubmit}>提交代码</Button>
      </div>
    </div>
  );
};
```

## 9. 样式开发

### 9.1 全局CSS变量

```css
/* index.css */
:root {
  /* Gemini 风格主题 */
  --gemini-bg: #f8f9fa;
  --gemini-surface: #ffffff;
  --gemini-surface-variant: #f1f3f4;
  --gemini-text-primary: #202124;
  --gemini-text-secondary: #5f6368;
  --gemini-text-tertiary: #80868b;
  --gemini-accent: #4285f4;
  --gemini-accent-strong: #1a73e8;
  --gemini-accent-text: #ffffff;
  --gemini-border-light: #e8eaed;
  --gemini-success: #34a853;
  --gemini-error: #ea4335;
  --gemini-warning: #fbbc04;
}
```

### 9.2 TailwindCSS使用

```tsx
// 使用Tailwind类名
<div className="flex items-center justify-between p-4 bg-white rounded-lg shadow-md">
  <h2 className="text-xl font-semibold text-gray-800">标题</h2>
  <Button className="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">
    按钮
  </Button>
</div>
```

## 10. 开发命令

```bash
# 安装依赖
npm install

# 开发模式
npm run dev

# 构建生产版本
npm run build

# 预览生产版本
npm run preview

# 代码检查
npm run lint
```

## 11. 开发规范

### 11.1 组件规范
- 使用函数组件 + Hooks
- 组件文件使用 PascalCase 命名
- 每个页面/组件放在独立文件夹中

### 11.2 状态管理
- 简单状态使用 useState
- 复杂状态使用 useReducer
- 全局状态使用 Context

### 11.3 样式规范
- 优先使用 TailwindCSS
- 复杂样式使用 CSS Modules
- 遵循 Gemini 设计风格
